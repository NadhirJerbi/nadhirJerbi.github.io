<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrum Master Quiz</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --success: #4cc9f0;
      --danger: #f72585;
      --warning: #f8961e;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .app-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 30px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 20px;
      font-size: 2.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .header-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      color: white;
      font-weight: 600;
    }

    /* Setup Screen */
    #setup {
      text-align: center;
    }

    .setup-options {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 25px 0;
    }

    .option-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    label {
      font-weight: 600;
      font-size: 1.1rem;
    }

    input, select {
      padding: 12px 15px;
      border: 2px solid #e1e5ee;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
      width: 100%;
      max-width: 300px;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--gray);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    /* Timer */
    #timer {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-weight: 600;
      backdrop-filter: blur(5px);
    }

    #time-remaining {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .timer-warning { color: var(--warning); animation: pulse 1s infinite; }
    .timer-danger { color: var(--danger); animation: pulse 0.5s infinite; }

    @keyframes pulse {
      0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; }
    }

    /* Quiz Navigation */
    #navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .nav-buttons { display: flex; gap: 10px; }
    .question-counter { font-weight: 600; color: var(--gray); }

    /* Quiz Container */
    #quiz-container {
      max-height: 60vh;
      overflow-y: auto;
      padding: 10px;
    }

    .question-block {
      margin-bottom: 25px;
      padding: 20px;
      border-radius: 12px;
      background: #f8f9fa;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .question-text { flex: 1; margin-right: 15px; }

    .mark-review {
      background: transparent;
      border: none;
      color: var(--warning);
      cursor: pointer;
      font-size: 1.2rem;
      transition: transform 0.3s;
    }

    .mark-review:hover { transform: scale(1.2); }
    .marked { color: var(--warning); }

    .answers { list-style: none; padding: 0; }

    .answers li {
      margin: 10px 0;
      padding: 12px 15px;
      border-radius: 8px;
      background: white;
      border: 2px solid #e1e5ee;
      transition: all 0.2s;
      cursor: pointer;
    }

    .answers li:hover {
      border-color: var(--primary);
      background: #f0f4ff;
    }

    .answers li.selected {
      border-color: var(--primary);
      background: #e6eeff;
    }

    .answers li.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .answers li.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    /* Progress Bar */
    .progress-container { margin: 20px 0; }
    .progress-bar {
      height: 10px;
      background: #e9ecef;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      background: var(--primary);
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 0.9rem;
      color: var(--gray);
    }

    /* Results */
    .result-summary { text-align: center; padding: 20px; }

    .score-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: conic-gradient(var(--success) 0% var(--p), #e9ecef var(--p) 100%);
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .score-inner {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .score-percent { font-size: 1.8rem; color: var(--dark); }
    .score-text { font-size: 0.9rem; color: var(--gray); }

    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
    }

    .stat { text-align: center; }
    .stat-value { font-size: 2rem; font-weight: bold; }
    .stat-correct { color: var(--success); }
    .stat-wrong { color: var(--danger); }
    .stat-label { font-size: 0.9rem; color: var(--gray); }

    #filter-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .filter-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background: #e9ecef;
      color: var(--gray);
      border: none;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
    }

    .question-card {
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      border-left: 6px solid;
    }

    .correct-card {
      background: #e8f5e9;
      border-left-color: #28a745;
    }

    .wrong-card {
      background: #ffebee;
      border-left-color: #dc3545;
    }

    .results-container { margin-top: 20px; }

    @media (max-width: 768px) {
      .app-card { padding: 20px; }
      h1 { font-size: 2rem; }
      .header-info { flex-direction: column; gap: 10px; text-align: center; }
      #navigation { flex-direction: column; gap: 15px; }
      .nav-buttons { width: 100%; justify-content: space-between; }
      .stats { flex-direction: column; gap: 15px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-brain"></i> Scrum Master Quiz</h1>
    
    <div class="header-info">
      <div id="user-info">Welcome to Scrum Quiz!</div>
      <div id="timer" style="display:none;">
        <i class="fas fa-clock"></i> Time Left: <span id="time-remaining">--:--</span>
      </div>
    </div>

    <!-- Setup Screen -->
    <div class="app-card" id="setup">
      <h2>Quiz Setup</h2>
      <p>Configure your quiz session below</p>
      
      <div class="setup-options">
        <div class="option-group">
          <label for="user-name">Your Name</label>
          <input type="text" id="user-name" placeholder="Enter your name" value="Quiz Taker">
        </div>
        
        <div class="option-group">
          <label for="num-questions">Number of Questions</label>
          <input type="number" id="num-questions" min="5" max="50" value="10">
        </div>
        
        <div class="option-group">
          <label for="time-per-question">Time per Question (seconds)</label>
          <input type="number" id="time-per-question" min="10" max="120" value="45">
        </div>
        
        <div class="option-group">
          <label for="question-type">Question Type</label>
          <select id="question-type">
            <option value="mixed">Mixed (Single & Multiple Choice)</option>
            <option value="single">Single Choice Only</option>
            <option value="multi">Multiple Choice Only</option>
          </select>
        </div>
      </div>
      
      <button id="start-btn" class="btn btn-primary">
        <i class="fas fa-play-circle"></i> Start Quiz
      </button>
    </div>

    <!-- Quiz Screen -->
    <div class="app-card" id="quiz-screen" style="display:none;">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress" id="quiz-progress" style="width: 0%"></div>
        </div>
        <div class="progress-info">
          <span>Progress: <span id="progress-text">0%</span></span>
          <span>Question <span id="current-q">1</span> of <span id="total-qs">10</span></span>
        </div>
      </div>
      
      <div id="quiz-container"></div>
      
      <div id="navigation">
        <div class="nav-buttons">
          <button id="prev-btn" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button id="next-btn" class="btn btn-primary">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        
        <div class="question-counter">
          <span id="marked-count">0</span> marked for review
        </div>
      </div>
      
      <div id="submit-container" style="display:none; text-align:center; margin-top:20px;">
        <button id="submit-btn" class="btn btn-success">
          <i class="fas fa-paper-plane"></i> Submit Quiz
        </button>
      </div>
    </div>

    <!-- Results Screen -->
    <div class="app-card" id="results-screen" style="display:none;">
      <div id="result"></div>
      <div id="results-container" class="results-container"></div>
    </div>

    <footer style="text-align: center; color: white; margin-top: 20px; opacity: 0.8;">
      <p>Hosted on GitHub Pages</p>
    </footer>
  </div>

  <script>
    // Quiz state
    let allQuestions = [];
    let questions = [];
    let currentIndex = 0;
    let timerInterval;
    let totalSeconds = 0;
    let markedQuestions = new Set();
    let userName = "Quiz Taker";

    // DOM elements
    const setupScreen = document.getElementById('setup');
    const quizScreen = document.getElementById('quiz-screen');
    const resultsScreen = document.getElementById('results-screen');
    const quizContainer = document.getElementById('quiz-container');
    const resultsContainer = document.getElementById('results-container');
    const timerElement = document.getElementById('timer');
    const timeRemainingElement = document.getElementById('time-remaining');
    const progressBar = document.getElementById('quiz-progress');
    const progressText = document.getElementById('progress-text');
    const currentQElement = document.getElementById('current-q');
    const totalQsElement = document.getElementById('total-qs');
    const markedCountElement = document.getElementById('marked-count');
    const userInfoElement = document.getElementById('user-info');

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      // Load user name
      const savedName = localStorage.getItem('quizUserName');
      if (savedName) {
        document.getElementById('user-name').value = savedName;
        userName = savedName;
        userInfoElement.textContent = `Welcome, ${userName}!`;
      }

      // Event listeners
      document.getElementById('start-btn').addEventListener('click', startQuiz);
      document.getElementById('prev-btn').addEventListener('click', goToPrevious);
      document.getElementById('next-btn').addEventListener('click', goToNext);
      document.getElementById('submit-btn').addEventListener('click', submitQuiz);
      document.getElementById('user-name').addEventListener('input', updateUserName);
    });

    function updateUserName() {
      userName = document.getElementById('user-name').value;
      userInfoElement.textContent = `Welcome, ${userName}!`;
      localStorage.setItem('quizUserName', userName);
    }

    // Start quiz
    async function startQuiz() {
      const numQuestions = parseInt(document.getElementById('num-questions').value);
      const timePerQuestion = parseInt(document.getElementById('time-per-question').value);
      const questionType = document.getElementById('question-type').value;
      
      if (isNaN(numQuestions) || numQuestions < 5) {
        alert("Please enter at least 5 questions.");
        return;
      }

      // Save user name
      localStorage.setItem('quizUserName', userName);

      // Show quiz screen
      setupScreen.style.display = 'none';
      quizScreen.style.display = 'block';
      timerElement.style.display = 'flex';
      
      // Load questions
      await loadQuiz(numQuestions, questionType);
      
      // Initialize quiz state
      currentIndex = 0;
      markedQuestions.clear();
      updateMarkedCount();
      
      // Start timer
      totalSeconds = numQuestions * timePerQuestion;
      startTimer();
      
      // Render first question
      renderQuestion(currentIndex);
      updateProgress();
    }

    // Load questions from JSON
    async function loadQuiz(totalQuestions, questionType) {
      try {
        // Use relative path for GitHub Pages
        const response = await fetch('quiz.json');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        allQuestions = await response.json();

        if (!allQuestions || allQuestions.length === 0) {
          quizContainer.innerHTML = '<p style="color:red">❌ No questions found in quiz.json</p>';
          return;
        }

        // Filter questions by type
        let filteredQuestions = [];
        if (questionType === 'single') {
          filteredQuestions = allQuestions.filter(q => !q.is_multi_choice);
        } else if (questionType === 'multi') {
          filteredQuestions = allQuestions.filter(q => q.is_multi_choice);
        } else {
          filteredQuestions = allQuestions;
        }
        
        // Shuffle and limit questions
        questions = shuffleArray(filteredQuestions).slice(0, totalQuestions);
        
        // Initialize user selections
        questions.forEach(q => {
          q.userSelected = [];
        });
        
        // Update UI
        totalQsElement.textContent = questions.length;
        
      } catch (error) {
        console.error('Error loading quiz:', error);
        quizContainer.innerHTML = `<p style="color:red">❌ Error loading quiz: ${error.message}</p>`;
        
        // Fallback: Use sample questions if quiz.json fails
        questions = generateSampleQuestions(10);
        questions.forEach(q => {
          q.userSelected = [];
        });
        totalQsElement.textContent = questions.length;
      }
    }

    // Generate sample questions for demo
    function generateSampleQuestions(count) {
      const sampleQuestions = [];
      for (let i = 1; i <= count; i++) {
        sampleQuestions.push({
          question: `Sample Question ${i}: What is Scrum?`,
          is_multi_choice: Math.random() > 0.5,
          answers: [
            "A framework for agile development",
            "A programming language",
            "A project management methodology",
            "A type of meeting"
          ],
          correct_answers: ["A framework for agile development"]
        });
      }
      return sampleQuestions;
    }

    // Render current question
    function renderQuestion(index) {
      const q = questions[index];
      quizContainer.innerHTML = '';
      
      const qDiv = document.createElement('div');
      qDiv.classList.add('question-block');
      
      // Question header with mark button
      const headerDiv = document.createElement('div');
      headerDiv.classList.add('question-header');
      
      const textDiv = document.createElement('div');
      textDiv.classList.add('question-text');
      
      const qTitle = document.createElement('h3');
      qTitle.textContent = `${index + 1}. ${q.question}`;
      textDiv.appendChild(qTitle);
      
      const markButton = document.createElement('button');
      markButton.classList.add('mark-review');
      markButton.innerHTML = markedQuestions.has(index) ? 
        '<i class="fas fa-bookmark marked"></i>' : 
        '<i class="far fa-bookmark"></i>';
      markButton.addEventListener('click', () => toggleMarkQuestion(index));
      
      headerDiv.appendChild(textDiv);
      headerDiv.appendChild(markButton);
      qDiv.appendChild(headerDiv);
      
      // Answers
      const ul = document.createElement('ul');
      ul.classList.add('answers');
      
      q.answers.forEach(ans => {
        const li = document.createElement('li');
        li.textContent = ans;
        
        if (q.userSelected && q.userSelected.includes(ans)) {
          li.classList.add('selected');
        }
        
        li.addEventListener('click', () => selectAnswer(index, ans, q.is_multi_choice));
        ul.appendChild(li);
      });
      
      qDiv.appendChild(ul);
      quizContainer.appendChild(qDiv);
      
      // Update navigation buttons
      updateNavigationButtons();
      currentQElement.textContent = index + 1;
    }

    // Select/deselect answer
    function selectAnswer(qIndex, answer, isMulti) {
      const q = questions[qIndex];
      
      if (isMulti) {
        if (q.userSelected.includes(answer)) {
          // Deselect
          q.userSelected = q.userSelected.filter(a => a !== answer);
        } else {
          // Select
          q.userSelected.push(answer);
        }
      } else {
        // Single choice - replace selection
        q.userSelected = [answer];
      }
      
      // Re-render question to update UI
      renderQuestion(qIndex);
    }

    // Toggle mark question for review
    function toggleMarkQuestion(index) {
      if (markedQuestions.has(index)) {
        markedQuestions.delete(index);
      } else {
        markedQuestions.add(index);
      }
      updateMarkedCount();
      renderQuestion(index);
    }

    // Update marked questions count
    function updateMarkedCount() {
      markedCountElement.textContent = markedQuestions.size;
    }

    // Navigation functions
    function goToPrevious() {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion(currentIndex);
        updateProgress();
      }
    }

    function goToNext() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion(currentIndex);
        updateProgress();
      }
    }

    // Update navigation buttons
    function updateNavigationButtons() {
      document.getElementById('prev-btn').style.display = currentIndex === 0 ? 'none' : 'inline-flex';
      document.getElementById('next-btn').style.display = currentIndex === questions.length - 1 ? 'none' : 'inline-flex';
      document.getElementById('submit-container').style.display = currentIndex === questions.length - 1 ? 'block' : 'none';
    }

    // Update progress bar
    function updateProgress() {
      const progress = ((currentIndex + 1) / questions.length) * 100;
      progressBar.style.width = `${progress}%`;
      progressText.textContent = `${Math.round(progress)}%`;
    }

    // Timer functions
    function startTimer() {
      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        totalSeconds--;
        updateTimerDisplay();
        
        // Timer warnings
        if (totalSeconds === 300) {
          timeRemainingElement.classList.add('timer-warning');
        } else if (totalSeconds === 60) {
          timeRemainingElement.classList.remove('timer-warning');
          timeRemainingElement.classList.add('timer-danger');
        }
        
        if (totalSeconds <= 0) {
          clearInterval(timerInterval);
          alert("⏰ Time's up! Submitting your answers automatically.");
          submitQuiz();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      timeRemainingElement.textContent = 
        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Submit quiz and show results
    function submitQuiz() {
      clearInterval(timerInterval);
      
      // Hide quiz screen, show results
      quizScreen.style.display = 'none';
      resultsScreen.style.display = 'block';
      
      // Calculate results
      let score = 0;
      questions.forEach(q => {
        const correctSorted = [...q.correct_answers].sort().join('|');
        const chosenSorted = (q.userSelected || []).sort().join('|');
        q.isCorrect = correctSorted === chosenSorted;
        if (q.isCorrect) score++;
      });
      
      showResults(score);
    }

    // Display results
    function showResults(score) {
      const correctCount = score;
      const wrongCount = questions.length - correctCount;
      const percentage = ((correctCount / questions.length) * 100).toFixed(1);
      
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <div class="result-summary">
          <h2>Quiz Results</h2>
          <p>Congratulations, ${userName}!</p>
          
          <div class="score-circle" style="--p: ${percentage}%">
            <div class="score-inner">
              <div class="score-percent">${percentage}%</div>
              <div class="score-text">Score</div>
            </div>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value stat-correct">${correctCount}</div>
              <div class="stat-label">Correct</div>
            </div>
            <div class="stat">
              <div class="stat-value stat-wrong">${wrongCount}</div>
              <div class="stat-label">Wrong</div>
            </div>
            <div class="stat">
              <div class="stat-value">${questions.length}</div>
              <div class="stat-label">Total</div>
            </div>
          </div>
          
          <div id="filter-buttons">
            <button class="filter-btn active" data-filter="all">All Questions</button>
            <button class="filter-btn" data-filter="correct">Correct Answers</button>
            <button class="filter-btn" data-filter="wrong">Wrong Answers</button>
          </div>
          
          <div style="margin-top: 20px;">
            <button class="btn btn-primary" onclick="restartQuiz()">
              <i class="fas fa-redo"></i> Take Another Quiz
            </button>
          </div>
        </div>
      `;
      
      // Add event listeners to filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          renderResults(this.getAttribute('data-filter'));
        });
      });
      
      // Render all questions initially
      renderResults('all');
    }

    // Render results based on filter
    function renderResults(filter = 'all') {
      resultsContainer.innerHTML = '';
      
      questions.forEach((q, idx) => {
        if (filter === 'correct' && !q.isCorrect) return;
        if (filter === 'wrong' && q.isCorrect) return;
        
        const qDiv = document.createElement('div');
        qDiv.classList.add('question-card');
        qDiv.classList.add(q.isCorrect ? 'correct-card' : 'wrong-card');
        
        const title = document.createElement('h3');
        title.textContent = `${idx + 1}. ${q.question}`;
        qDiv.appendChild(title);
        
        const ul = document.createElement('ul');
        ul.classList.add('answers');
        
        q.answers.forEach(ans => {
          const li = document.createElement('li');
          li.textContent = ans;
          
          if (q.correct_answers.includes(ans)) {
            li.classList.add('correct');
          }
          
          if (q.userSelected && q.userSelected.includes(ans) && !q.correct_answers.includes(ans)) {
            li.classList.add('incorrect');
          }
          
          if (q.userSelected && q.userSelected.includes(ans)) {
            li.style.fontWeight = 'bold';
          }
          
          ul.appendChild(li);
        });
        
        qDiv.appendChild(ul);
        resultsContainer.appendChild(qDiv);
      });
    }

    // Restart quiz
    function restartQuiz() {
      resultsScreen.style.display = 'none';
      setupScreen.style.display = 'block';
      timerElement.style.display = 'none';
    }

    // Utility functions
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
  </script>
</body>
</html>